<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create a Page | Activity Hub</title>
  <link rel="icon" href="https://i.imgur.com/EsNcDyR.png"/>
  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' };</script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 relative">

  <!-- PAGE TYPE SELECTION -->
  <div id="pageTypeSelection" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 flex items-center justify-center z-50">
    <div class="max-w-md bg-white dark:bg-gray-800 p-8 rounded-xl shadow space-y-6">
      <h1 class="text-2xl font-semibold text-center text-gray-800 dark:text-gray-100">Select Page Type</h1>
      <p class="text-center text-sm text-gray-600 dark:text-gray-400">
        Thank you for joining our early onboarding experience on Activityâ€¯Hub! Which type of page would you like to create?
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <button type="button" data-type="Club Page"
                class="page-type-card p-6 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg flex flex-col items-center space-y-2">
          <i class="fas fa-users fa-2x text-blue-600"></i>
          <span class="mt-2 text-lg font-medium">Club Page</span>
        </button>
        <button type="button" data-type="Business Page"
                class="page-type-card p-6 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg flex flex-col items-center space-y-2">
          <i class="fas fa-briefcase fa-2x text-green-600"></i>
          <span class="mt-2 text-lg font-medium">Business Page</span>
        </button>
        <button type="button" data-type="Project Page"
                class="page-type-card p-6 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-lg flex flex-col items-center space-y-2">
          <i class="fas fa-project-diagram fa-2x text-purple-600"></i>
          <span class="mt-2 text-lg font-medium">Project Page</span>
        </button>
      </div>
    </div>
  </div>

  <!-- AUTH FLOW OVERLAY -->
  <div id="authFlow" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 flex items-center justify-center z-50 hidden">
    <div class="max-w-md w-full bg-white dark:bg-gray-800 p-8 rounded-xl shadow space-y-6">
      <!-- Step 0: Choose Login vs Signup -->
      <div id="authStep0" class="space-y-4 text-center">
        <h2 class="text-2xl font-semibold">Account Setup</h2>
        <button id="btnHaveAccount" class="w-full bg-blue-600 text-white py-2 rounded">I have an account</button>
        <button id="btnNewAccount"  class="w-full bg-green-600 text-white py-2 rounded">I need to create one</button>
      </div>
      <!-- Step 1a: Login form -->
      <div id="authStepLogin" class="hidden space-y-4">
        <h3 class="text-xl font-semibold">Log In</h3>
        <input id="loginEmail"    type="email"    placeholder="Email"    class="w-full px-4 py-2 border rounded"/>
        <input id="loginPassword" type="password" placeholder="Password" class="w-full px-4 py-2 border rounded"/>
        <p id="loginError" class="text-red-500 text-sm"></p>
        <div class="flex space-x-2">
          <button id="loginBack" class="flex-1 bg-gray-300 py-2 rounded">Back</button>
          <button id="btnLogin"  class="flex-1 bg-blue-600 text-white py-2 rounded">Login</button>
        </div>
      </div>
      <!-- Step 1b: Signup form -->
      <div id="authStepSignup" class="hidden space-y-4">
        <h3 class="text-xl font-semibold">Create Account</h3>
        <input id="signupEmail"    type="email"    placeholder="Email"    class="w-full px-4 py-2 border rounded"/>
        <input id="signupPassword" type="password" placeholder="Password" class="w-full px-4 py-2 border rounded"/>
        <p id="signupError" class="text-red-500 text-sm"></p>
        <div class="flex space-x-2">
          <button id="signupBack" class="flex-1 bg-gray-300 py-2 rounded">Back</button>
          <button id="btnSignup"  class="flex-1 bg-green-600 text-white py-2 rounded">Next</button>
        </div>
      </div>
      <!-- Step 2: Personal Information (for new signup) -->
      <div id="authStepPersonal" class="hidden space-y-4">
        <h3 class="text-xl font-semibold">Personal Information</h3>
        <input id="personalFirstName" type="text" placeholder="First Name" class="w-full px-4 py-2 border rounded"/>
        <input id="personalLastName"  type="text" placeholder="Last Name"  class="w-full px-4 py-2 border rounded"/>
        <input id="personalEduEmail"  type="email" placeholder="Educational Email" class="w-full px-4 py-2 border rounded"/>
        <input id="personalCollege"   type="text" placeholder="College" class="w-full px-4 py-2 border rounded"/>
        <input id="personalMajor"     type="text" placeholder="Major (optional)" class="w-full px-4 py-2 border rounded"/>
        <div class="flex space-x-2">
          <button id="personalBack"    class="flex-1 bg-gray-300 py-2 rounded">Back</button>
          <button id="btnPersonalNext" class="flex-1 bg-green-600 text-white py-2 rounded">Continue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AUTH LOADING OVERLAY -->
  <div id="authLoading" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded-lg flex items-center space-x-3">
      <i class="fas fa-spinner fa-spin fa-2x text-blue-600"></i>
      <span class="text-lg">Processing...</span>
    </div>
  </div>

  <div id="mainContent" class="hidden">
    <!-- SUBMITTING OVERLAY -->
    <div id="submittingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div class="bg-white dark:bg-gray-800 p-6 rounded-lg flex flex-col items-center space-y-4">
        <i class="fas fa-spinner fa-3x animate-spin text-blue-600"></i>
        <p class="text-lg">Submitting your page...</p>
      </div>
    </div>

    <!-- HEADER (sidebar removed) -->
    <header class="fixed inset-x-0 top-0 h-16 bg-white dark:bg-gray-800 shadow flex items-center px-4 z-50">
      <a href="#" class="flex items-center">
        <img src="https://i.imgur.com/T28QHq2.png" alt="Activity Hub Logo" class="h-10"/>
      </a>
      <div class="ml-auto flex items-center">
        <i id="darkIcon" class="fas fa-moon text-gray-600 dark:text-gray-300 mr-2 cursor-pointer"></i>
        <input id="darkToggleHeader" type="checkbox" class="sr-only"/>
      </div>
    </header>

    <div class="pt-16">
      <main class="p-6 transition-all duration-300">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row gap-6">

          <!-- Form Column -->
          <div id="formContainer" class="w-full md:w-2/3 bg-white dark:bg-gray-800 p-8 rounded-xl shadow space-y-6">
            <h1 class="text-2xl font-semibold">Create a New Page</h1>
            <form id="createClubForm" class="space-y-6">

              <!-- Hidden account fields from OG -->
              <input type="hidden" name="entry.1302831663" id="authEmail" />
              <input type="hidden" name="entry.1633033794" id="authPassword" />
              <input type="hidden" name="entry.558536691" id="authFirstName" />
              <input type="hidden" name="entry.1158899171" id="authLastName" />
              <input type="hidden" name="entry.591976255" id="authEduEmail" />
              <input type="hidden" name="entry.305561957" id="authCollege" />
              <input type="hidden" name="entry.2056172019" id="authMajor" />
              <input type="hidden" name="entry.1076193597" id="authProfilePicURL" />
              <input type="hidden" name="entry.1327198714" id="authUserID" />

              <!-- Hidden page type -->
              <input type="hidden" name="entry.362637871" id="inputPageType" value="">

              <!-- Overview (always visible) -->
              <section>
                <h2 class="text-xl font-semibold mb-4">Overview</h2>
                <div id="overviewContent" class="space-y-4">
                  <div>
                    <label class="block text-sm font-medium mb-1">Page Title</label>
                    <input id="inputName" name="entry.244953197" type="text" placeholder="Enter title" required
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                  focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                  dark:bg-gray-700"/>
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">Tagline</label>
                    <input id="inputTagline" name="entry.1419351904" type="text" placeholder="Short tagline"
                           class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                  focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                  dark:bg-gray-700"/>
                  </div>
                  <div>
                    <label class="block text-sm font-medium mb-1">Description</label>
                    <textarea id="inputDesc" name="entry.1663281528" rows="4" placeholder="Brief description" required
                              class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                     focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                     dark:bg-gray-700"></textarea>
                  </div>
                </div>
              </section>

              <!-- Details -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label for="inputAffiliation" class="block text-sm font-medium mb-1">Affiliation</label>
                  <select id="inputAffiliation" name="entry.1827366832"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                 dark:bg-gray-700">
                    <option>Independent</option>
                    <option>Student Government Recognized</option>
                  </select>
                  <p id="affiliationNote" class="mt-1 text-sm text-gray-600 dark:text-gray-400 hidden">
                    Affiliation must be verified by student government for a blue badge.
                  </p>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Number of Participants</label>
                  <input id="inputCount" name="entry.1294678231" type="number" min="1" value="1"
                         class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                dark:bg-gray-700"/>
                </div>
                <div>
                  <label for="inputTheme" class="block text-sm font-medium mb-1">Theme</label>
                  <select id="inputTheme" name="entry.2118515615"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                 dark:bg-gray-700">
                    <option>Academic</option>
                    <option>Professional Development</option>
                    <option>Service / Volunteering</option>
                    <option>Recreational</option>
                    <option>Sports & Athletics</option>
                    <option>Religious / Spiritual</option>
                    <option>Cultural / Identity-Based</option>
                    <option>Arts & Media</option>
                    <option>Political / Activism</option>
                  </select>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Industry</label>
                  <select id="inputIndustry" name="entry.1103064816"
                          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded
                                 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                 dark:bg-gray-700">
                    <option>STEM</option>
                    <option>Healthcare</option>
                    <option>Education</option>
                    <option>Business</option>
                    <option>Finance</option>
                    <option>Marketing</option>
                    <option>Design / Creative</option>
                    <option>Media / Journalism</option>
                    <option>Law</option>
                    <option>Government / Policy</option>
                    <option>Social Impact / Nonprofit</option>
                    <option>Gaming</option>
                    <option>Fashion</option>
                    <option>Environment / Sustainability</option>
                    <option>Startups / Innovation</option>
                  </select>
                </div>
                <div class="md:col-span-2">
                  <label class="block text-sm font-medium mb-1">Logo Upload</label>
                  <div id="dropzone"
                       class="relative flex items-center justify-center h-32 border-2 border-dashed border-gray-300 bg-gray-50 dark:bg-gray-800 dark:border-gray-600 rounded transition-colors">
                    <i id="dropzoneSpinner" class="fas fa-spinner fa-2x text-gray-400 animate-spin hidden absolute"></i>
                    <div id="dropzonePlaceholder" class="flex flex-col items-center justify-center h-full text-center">
                      <i class="fas fa-upload fa-2x text-gray-400"></i>
                      <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                        Drag &amp; drop your logo<br/>or click to choose
                      </p>
                    </div>
                    <div id="uploadedPreview" class="hidden flex items-center justify-between w-full px-4">
                      <div class="flex items-center space-x-3">
                        <img id="dropzonePreview" class="h-16 w-16 rounded-lg object-cover border"/>
                        <span id="dropzoneFilename" class="text-sm text-gray-700 dark:text-gray-300 truncate"></span>
                      </div>
                      <button id="dropzoneRemoveBtn" type="button"
                              class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-100">
                        <i class="fas fa-times"></i><span class="sr-only">Remove uploaded logo</span>
                      </button>
                    </div>
                    <input id="createLogoInput" type="file" accept="image/*"
                           class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"/>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Contact Email</label>
                  <input id="inputEmail" name="entry.2065357189" type="email" placeholder="club@domain.edu"
                         class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                dark:bg-gray-700"/>
                </div>
                <div>
                  <label class="block text-sm font-medium mb-1">Contact Form (optional)</label>
                  <input id="inputForm" name="entry.995034897" type="url" placeholder="https://forms.example.com"
                         class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                dark:bg-gray-700"/>
                </div>
              </div>

              <!-- External Links (collapsed by default) -->
              <div>
                <h2 id="socialToggle" class="flex items-center text-lg font-medium cursor-pointer">
                  External Links (optional)
                  <i id="socialIcon" class="fas fa-chevron-right ml-2"></i>
                </h2>
                <div id="socialContent" class="space-y-4 overflow-hidden" style="max-height:0;transition:max-height 0.3s ease;">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label class="block text-sm mb-1">Instagram</label>
                      <input id="inputInstagram" name="entry.2095010028" type="url" placeholder="https://instagram.com/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">LinkedIn</label>
                      <input id="inputLinkedIn" name="entry.1802286959" type="url" placeholder="https://linkedin.com/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">YouTube</label>
                      <input id="inputYouTube" name="entry.53226177" type="url" placeholder="https://youtube.com/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">GitHub</label>
                      <input id="inputGitHub" name="entry.150994526" type="url" placeholder="https://github.com/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">TikTok</label>
                      <input id="inputTikTok" name="entry.1562451982" type="url" placeholder="https://tiktok.com/@yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">Discord</label>
                      <input id="inputDiscord" name="entry.913273410" type="url" placeholder="https://discord.gg/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">GroupMe</label>
                      <input id="inputGroupMe" name="entry.100258116" type="url" placeholder="https://groupme.com/join/yourclub"
                             class="w-full px-4 py-2	border	border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                    <div>
                      <label class="block text-sm mb-1">Twitter</label>
                      <input id="inputTwitter" name="entry.680101451" type="url" placeholder="https://twitter.com/yourclub"
                             class="w-full px-4 py-2	border border-gray-300 dark:border-gray-600 rounded
                                    focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500
                                    dark:bg-gray-700"/>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Terms & Submit -->
              <div class="flex items-start">
                <input id="authCheckbox" type="checkbox" required
                       class="mt-1 mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded
                              focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500"/>
                <label for="authCheckbox" class="text-sm">
                  I verify that I am an authorized representative of this organization.
                </label>
              </div>
              <div class="text-right">
                <button id="submitBtn" type="submit"
                        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700
                               focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 focus:border-blue-500 flex items-center space-x-2">
                  <i class="fas fa-paper-plane"></i>
                  <span>Create Page</span>
                </button>
              </div>
            </form>
          </div>

          <!-- SUCCESS MESSAGE -->
          <div id="successMessage" class="hidden w-full md:w-2/3 bg-white dark:bg-gray-800 p-8 rounded-xl shadow text-center">
            <i class="fas fa-check-circle fa-3x text-green-500 mb-4"></i>
            <h2 class="text-2xl font-semibold mb-2">Page Created!</h2>
            <p class="mb-4">Thanks for being part of the early onboarding experience at Activity Hub. Youâ€™ve successfully submitted your club page and are now part of the first wave helping shape the platform before launch. Weâ€™re still putting on the finishing touches, but your info is saved and ready to go live when we launch.</p>
            <a href="Clubs.html" class="inline-block bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
              View All Pages
            </a>
          </div>

          <!-- Page Preview Column -->
          <div class="w-full md:w-1/3">
            <div class="sticky" style="top:calc(4rem + 1.5rem);">
              <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
                <h2 class="text-xl font-semibold mb-4">Page Preview</h2>
                <div class="space-y-4 text-center">
                  <div id="previewLogoPlaceholder" class="h-24 w-24 flex items-center justify-center bg-gray-200 dark:bg-gray-700 rounded-full mx-auto">
                    <i class="fas fa-image text-4xl text-gray-400"></i>
                  </div>
                  <img id="previewLogo" src="" alt="Logo"
                       class="h-24 w-24 object-cover rounded-full border mx-auto hidden"/>
                  <h3 id="previewName" data-default="Page Title" class="text-2xl font-bold">Page Title</h3>
                  <p id="previewTagline" data-default="Tagline goes here" class="italic text-gray-600 dark:text-gray-400">Tagline goes here</p>
                  <p id="previewDesc" data-default="Description previewâ€¦" class="text-gray-700 dark:text-gray-300">Description previewâ€¦</p>
                  <div id="previewSocials" class="flex items-center justify-center space-x-2 mt-4"></div>
                </div>
              </div>
            </div>
          </div>

        </div>
      </main>
    </div>
  </div>

  <script>
    // --- AUTH FLOW LOGIC ---
    function showAuthStep(name) {
      document.getElementById('authStep0').classList.toggle('hidden', name !== 'choose');
      document.getElementById('authStepLogin').classList.toggle('hidden', name !== 'login');
      document.getElementById('authStepSignup').classList.toggle('hidden', name !== 'signup');
      document.getElementById('authStepPersonal').classList.toggle('hidden', name !== 'personal');
    }

    // After page type chosen, show auth
    document.querySelectorAll('.page-type-card').forEach(card => {
      card.addEventListener('click', () => {
        const type = card.dataset.type;
        document.getElementById('inputPageType').value = type;
        updateFieldLabels(type);
        document.getElementById('pageTypeSelection').classList.add('hidden');
        document.getElementById('authFlow').classList.remove('hidden');
        showAuthStep('choose');
      });
    });

    // Step 0 buttons
    document.getElementById('btnHaveAccount').onclick = () => showAuthStep('login');
    document.getElementById('loginBack').onclick    = () => showAuthStep('choose');
    document.getElementById('btnNewAccount').onclick = () => showAuthStep('signup');
    document.getElementById('signupBack').onclick   = () => showAuthStep('choose');

    // Show loading overlay during auth fetches
    async function performAuthFetch(fn) {
      document.getElementById('authLoading').classList.remove('hidden');
      try { await fn(); } finally { document.getElementById('authLoading').classList.add('hidden'); }
    }

    // Login handler
    document.getElementById('btnLogin').onclick = () => performAuthFetch(async () => {
      const email    = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const res = await fetch('https://sheet2api.com/v1/rkmbUqHQAC3C/submission-form-responses');
      const data = await res.json();
      const record = data.find(r => r.Email.toLowerCase() === email.toLowerCase() && r.Password === password);
      if (!record) {
        document.getElementById('loginError').textContent = 'Invalid email or password.';
        return;
      }
      // Populate hidden fields
      document.getElementById('authEmail').value        = email;
      document.getElementById('authPassword').value     = password;
      document.getElementById('authFirstName').value    = record['First Name'] || '';
      document.getElementById('authLastName').value     = record['Last Name'] || '';
      document.getElementById('authEduEmail').value     = record['Email Address (.edu)'] || '';
      document.getElementById('authCollege').value      = record['College or University Name'] || '';
      document.getElementById('authMajor').value        = record['Major'] || '';
      document.getElementById('authProfilePicURL').value= record['Profile Picture'] || '';
      document.getElementById('authUserID').value       = record['User ID'] || '';
      finishAuth();
    });

    // Signup handler
    document.getElementById('btnSignup').onclick = () => performAuthFetch(async () => {
      const email    = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const res = await fetch('https://sheet2api.com/v1/rkmbUqHQAC3C/submission-form-responses');
      const data = await res.json();
      if (data.some(r => r.Email.toLowerCase() === email.toLowerCase())) {
        document.getElementById('signupError').textContent = 'Email exists. Please log in.';
        return;
      }
      const ids = data.map(r => Number(r['User ID']) || 0);
      const newID = ids.length ? Math.max(...ids) + 1 : 1;
      document.getElementById('authEmail').value    = email;
      document.getElementById('authPassword').value = password;
      document.getElementById('authUserID').value   = newID;
      showAuthStep('personal');
    });

    // Personal info step
    document.getElementById('personalBack').onclick    = () => showAuthStep('signup');
    document.getElementById('btnPersonalNext').onclick = () => {
      document.getElementById('authFirstName').value = document.getElementById('personalFirstName').value.trim();
      document.getElementById('authLastName').value  = document.getElementById('personalLastName').value.trim();
      document.getElementById('authEduEmail').value  = document.getElementById('personalEduEmail').value.trim();
      document.getElementById('authCollege').value   = document.getElementById('personalCollege').value.trim();
      document.getElementById('authMajor').value     = document.getElementById('personalMajor').value.trim();
      finishAuth();
    };

    function finishAuth() {
      document.getElementById('authFlow').classList.add('hidden');
      document.getElementById('mainContent').classList.remove('hidden');
    }

    // Swap labels based on page type
    function updateFieldLabels(pageType) {
      const themeLbl = document.querySelector('label[for="inputTheme"]');
      const affLbl   = document.querySelector('label[for="inputAffiliation"]');
      if (pageType === 'Business Page') {
        themeLbl.textContent = 'Business Type';
        affLbl.textContent   = 'Stage';
      } else {
        themeLbl.textContent = 'Theme';
        affLbl.textContent   = 'Affiliation';
      }
    }

    // Sync labels on load
    document.addEventListener('DOMContentLoaded', () => {
      const initial = document.getElementById('inputPageType').value;
      if (initial) updateFieldLabels(initial);
    });

    // Collapsible helper (only for External Links)
    function makeCollapsible(toggleId, contentId, iconId, openByDefault) {
      const tog = document.getElementById(toggleId),
            cont = document.getElementById(contentId),
            ic = document.getElementById(iconId);
      tog.addEventListener('click', () => {
        const isOpen = cont.style.maxHeight && cont.style.maxHeight !== '0px';
        cont.style.maxHeight = isOpen ? '0' : cont.scrollHeight + 'px';
        ic.classList.toggle('fa-chevron-down', !isOpen);
        ic.classList.toggle('fa-chevron-right', isOpen);
      });
      if (openByDefault) {
        cont.style.maxHeight = cont.scrollHeight + 'px';
        ic.classList.add('fa-chevron-down');
      } else {
        cont.style.maxHeight = '0';
        ic.classList.add('fa-chevron-right');
      }
    }

    // Initialize only External Links collapsible
    document.addEventListener('DOMContentLoaded', () => {
      makeCollapsible('socialToggle','socialContent','socialIcon', false);
    });

    // Auto-open social on email focus
    document.getElementById('inputEmail').addEventListener('focus', () => {
      const cont = document.getElementById('socialContent');
      if (cont.style.maxHeight === '0px') {
        document.getElementById('socialToggle').click();
      }
    });

    // Logo upload logic & live preview
    (function() {
      const dropzone        = document.getElementById('dropzone'),
            logoInput       = document.getElementById('createLogoInput'),
            spinner         = document.getElementById('dropzoneSpinner'),
            placeholder     = document.getElementById('dropzonePlaceholder'),
            uploadedPreview = document.getElementById('uploadedPreview'),
            dzImg           = document.getElementById('dropzonePreview'),
            dzName          = document.getElementById('dropzoneFilename'),
            removeBtn       = document.getElementById('dropzoneRemoveBtn'),
            livePrev        = document.getElementById('previewLogo'),
            livePlace       = document.getElementById('previewLogoPlaceholder');

      function handleLogoUpload(file) {
        spinner.classList.remove('hidden');
        placeholder.classList.add('opacity-50');
        const url = URL.createObjectURL(file);
        dzImg.src = url;
        dzName.textContent = file.name;
        dzImg.onload = () => {
          spinner.classList.add('hidden');
          placeholder.classList.add('hidden');
          uploadedPreview.classList.remove('hidden');
          logoInput.style.display = 'none';
        };
        livePrev.src = url;
        livePrev.onload = () => {
          livePlace.classList.add('hidden');
          livePrev.classList.remove('hidden');
        };
      }

      ['dragover','dragleave','drop'].forEach(evt => {
        dropzone.addEventListener(evt, e => {
          e.preventDefault();
          if (evt==='dragover') dropzone.classList.add('border-blue-400');
          if (evt==='dragleave') dropzone.classList.remove('border-blue-400');
          if (evt==='drop') {
            dropzone.classList.remove('border-blue-400');
            if (e.dataTransfer.files.length) {
              logoInput.files = e.dataTransfer.files;
              handleLogoUpload(e.dataTransfer.files[0]);
            }
          }
        });
      });

      logoInput.addEventListener('change', e => {
        if (e.target.files.length) handleLogoUpload(e.target.files[0]);
      });

      removeBtn.addEventListener('click', e => {
        e.stopPropagation();
        logoInput.value = '';
        uploadedPreview.classList.add('hidden');
        placeholder.classList.remove('hidden','opacity-50');
        livePrev.src = '';
        livePrev.classList.add('hidden');
        livePlace.classList.remove('hidden');
        logoInput.style.display = '';
      });

      uploadedPreview.addEventListener('click', e => e.stopPropagation());
    })();

    // Live text preview
    ['Name','Tagline','Desc'].forEach(suffix => {
      const inp = document.getElementById('input' + suffix),
            prev = document.getElementById('preview' + suffix),
            def  = prev.getAttribute('data-default');
      inp.addEventListener('input', () => {
        prev.textContent = inp.value.trim() || def;
      });
    });

    // Social preview
    (function(){
      const socialMap = {
        inputInstagram:'fab fa-instagram',
        inputLinkedIn: 'fab fa-linkedin',
        inputYouTube:  'fab fa-youtube',
        inputGitHub:   'fab fa-github',
        inputTikTok:   'fab fa-tiktok',
        inputDiscord:  'fab fa-discord',
        inputGroupMe:  'fas fa-users',
        inputTwitter:  'fab fa-twitter'
      };
      const updateSocialPreview = () => {
        const cont = document.getElementById('previewSocials');
        cont.innerHTML = '';
        const entries = Object.entries(socialMap)
          .map(([id,icon])=>({url: document.getElementById(id).value.trim(), icon}))
          .filter(e=>e.url);
        entries.slice(0,4).forEach(e=>{
          const a = document.createElement('a');
          a.href = e.url; a.target = '_blank';
          a.innerHTML = '<i class="' + e.icon + ' fa-lg"></i>';
          cont.appendChild(a);
        });
        if(entries.length>4){
          const more = document.createElement('span');
          more.className='text-gray-500 dark:text-gray-400';
          more.textContent = '+' + (entries.length-4);
          cont.appendChild(more);
        }
      };
      Object.keys(socialMap).forEach(id=>{
        document.getElementById(id).addEventListener('input', updateSocialPreview);
      });
      updateSocialPreview();
    })();

    // Form submission (Imgur + Google Forms + animation)
    document.getElementById('createClubForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      document.getElementById('submittingOverlay').classList.remove('hidden');
      document.getElementById('submitBtn').disabled = true;

      const logoInput = document.getElementById('createLogoInput'),
            file = logoInput.files[0];
      let logoUrl = '';

      if (file) {
        const imgurForm = new FormData();
        imgurForm.append('image', file);
        try {
          const imgurRes = await fetch('https://api.imgur.com/3/image', {
            method: 'POST',
            headers: { Authorization: 'Client-ID 4693c5376af54cb' },
            body: imgurForm
          });
          const imgurJson = await imgurRes.json();
          if (imgurJson.success && imgurJson.data.link) {
            logoUrl = imgurJson.data.link;
          } else throw new Error('Imgur did not return a link');
        } catch (err) {
          console.error('Imgur upload failed:', err);
          alert('Logo upload failed, please try again.');
          document.getElementById('submittingOverlay').classList.add('hidden');
          document.getElementById('submitBtn').disabled = false;
          return;
        }
      }

      const gfData = new URLSearchParams();
      // account fields
      ['authEmail','authPassword','authFirstName','authLastName','authEduEmail','authCollege','authMajor','authProfilePicURL','authUserID']
        .forEach(id => gfData.append(document.querySelector(`input#${id}`).name, document.getElementById(id).value));
      // page fields
      [
        ['entry.362637871','inputPageType'],
        ['entry.244953197','inputName'],
        ['entry.1419351904','inputTagline'],
        ['entry.1663281528','inputDesc'],
        ['entry.1827366832','inputAffiliation'],
        ['entry.1294678231','inputCount'],
        ['entry.2118515615','inputTheme'],
        ['entry.1103064816','inputIndustry'],
        ['entry.2122459244',null]
      ].forEach(([entry, id])=>{
        gfData.append(entry, id ? document.getElementById(id).value : logoUrl);
      });
      // contact + social
      [
        ['entry.2065357189','inputEmail'],
        ['entry.995034897','inputForm'],
        ['entry.2095010028','inputInstagram'],
        ['entry.1802286959','inputLinkedIn'],
        ['entry.53226177','inputYouTube'],
        ['entry.150994526','inputGitHub'],
        ['entry.1562451982','inputTikTok'],
        ['entry.913273410','inputDiscord'],
        ['entry.100258116','inputGroupMe'],
        ['entry.680101451','inputTwitter']
      ].forEach(([entry,id]) => gfData.append(entry, document.getElementById(id).value));

      fetch('https://docs.google.com/forms/d/e/1FAIpQLSeXyQeEF8mJdILhOuI44PNayI5AMmsC6IbFPuPoIjUNGSqVZQ/formResponse', {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: gfData.toString(),
      })
      .then(() => {
        document.getElementById('submittingOverlay').classList.add('hidden');
        document.getElementById('formContainer').classList.add('hidden');
        document.getElementById('successMessage').classList.remove('hidden');
      })
      .catch(err => {
        console.error('Google Form submission error:', err);
        alert('Submission failed, please try again.');
        document.getElementById('submittingOverlay').classList.add('hidden');
        document.getElementById('submitBtn').disabled = false;
      });
    });
  </script>
</body>
</html>
